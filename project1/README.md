Όνομα: Nikolaos Pnevmatikos

-------------------------------------------------------------------------------------------------

Εκτέλεση: make compile
./sniffer
h
./sniffer -p [ path_name ]

Εκτέλεση bash script:
chmod +x finder.sh
./finder.sh [ number of tld ]

-------------------------------------------------------------------------------------------------

Υποθέτουμε ότι ο φάκελος προς παρακολούθηση είναι αρχικά κενός η τα αρχεία που περιέχει δεν μας ενδιαφέρουν.

Η main αποτελεί την οντότητα manager. Η ουρα υλοποιήθηκε με vector ο οποιος κρατάει το id του κάθε worker και μια bool μεταβλητή για το αν είναι διαθέσιμος.

Κατά την εκτέλεση του προγράμματος δημιουργούνται, αν δεν υπάρχουν ήδη οι φάκελοι outfolder και fifos, που θα περιέχουν τα .out αρχεία και named pipes αντίστοιχα. Μετά δημιουργείται το pipe μεταξύ manager και listener και γίνεται fork για να δημιουργηθεί ο listener. Ο listener ανακατευθύνει την έξοδο του στο pipe και εκτελεί την inotifywait με ορίσματα create και moved_το, ώστε να παρακολουθεί μονο τα αρχεία που δημιουργούνται η μετακινούνται στον φάκελο που δώσαμε ως path.

Ο manager διαβάζει την έξοδο που έχει γράψει ο listener στο pipe και γράμμα-γράμμα θα εξάγει το όνομα του αρχείου. Αυτό το κάνει διαβάζοντας 7 + (μέγεθος path) γράμματα. Εκεί κάνει έλεγχο για να δει αν η εντολή που επέστρεψε η inotifywait είναι η create ή η move_το. Αν ο χαρακτήρας είναι 'E' τότε είναι η Create και άρα το όνομα του αρχείου θα αρχίζει 2 χαρακτήρες μετά, αν όχι είναι η move_το και το όνομα του αρχείου αρχίζει 4 χαρακτήρες μετά. (πχ. urls/CREATE one). Αφού βρεθεί ο αριθμός της επανάληψης που θα αρχίζει το όνομα του αρχείου, χαρακτήρα-χαρακτήρα το αρχείο αποθηκεύεται σε ένα string μέχρι να συναντηθεί "\η".

Αφού βρεθεί το όνομα του αρχείου ο manager διατρέχει τον vector για να βρει αν υπάρχει worker και αν είναι διαθέσιμος. Αν βρεθεί worker τότε δεν θα γίνει καινούριο fork και ο manager θα συνεχίσει την διεργασία που βρήκε. Αν δεν βρεθεί τότε γίνεται fork και ο worker που δημιουργείται μπαίνει στο vector.

ο manager δημιουργεί fifo για τον κάθε worker με όνομα "fifos/myfifo{process_id}". Ανοίγει το fifo με δικαιώματα write και γραφει το όνομα του αρχείου. Μετά κάνει reset το string που είχε το όνομα του αρχείου, τις επανάληψεις και την θέση που αρχίζει το string.

ο κάθε worker εκτελεί την συνάρτηση work() 




-------------------------------------------------------------------------------------------------

Bash script:

Στο bash script μέσω της find παίρνω όλα τα αρχεία που τελειώνουν σε .out από τον φάκελο outfiles. Μετά μέσω for, για κάθε argument που δόθηκε τρέχω γραμμή γραμμή το κάθε αρχείο και ψάχνω αν το .tld είναι substring της γραμμής. Αν ναι αυξάνω τον μετρητή. τέλος για κάθε tld εκτυπώνω πόσες φορες εμφανίστηκε στα αρχεία που εξετάστηκαν.
